<!DOCTYPE html>
<html>
<head>
    <title>Send Push message</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-messaging.js"></script>
</head>

<body>
    <h1>Send Push message</h1>
    <form id="notification-form" action="/send-message" method="post">
        <label for="token">Token:</label><br>
        <input type="text" id="token" name="token" readonly><br><br>
        <label for="title">Title:</label><br>
        <input type="text" id="title" name="title" required><br><br>
        <label for="message">Message:</label><br>
        <textarea id="message" name="message" required></textarea><br><br>
        <input type="submit" value="Send Message">
    </form>
</body>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCybtGa3ewvhu09JIzBCyodpbHJ-9infsI",
        authDomain: "lasm-go.firebaseapp.com",
        databaseURL: "https://lasm-go-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "lasm-go",
        storageBucket: "lasm-go.appspot.com",
        messagingSenderId: "69394339404",
        appId: "1:69394339404:web:40c6f58a252782a911c6e9",
        measurementId: "G-FJLD4TB9J8"
    };
    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    function requestPermissionAndGetToken() {
        Notification.requestPermission().then(permission => {
            if (permission === "granted") {
                console.log("Notification permission granted.");
                messaging.getToken({vapidKey: "BNp9uoxuD9eO0BgXIQCp1Yzsx3qutR7q3iuGo8VJfWs-zJLsF8avGBZk9M287ZfO_SIKfyZNrYF91yH3MGM-2AM"}).then((currentToken) => {
                    if (currentToken) {
                        console.log("Token:", currentToken);
                        document.getElementById('token').value = currentToken;
                    } else {
                        console.log("No Instance ID token available. Request permission to generate one.");
                    }
                }).catch((err) => {
                    console.log("An error occurred while retrieving token. ", err);
                });
            } else {
                console.log("Unable to get permission to notify.", permission);
            }
        }).catch((err) => {
            console.error("Error in getting notification permission", err);
        });
    }

    requestPermissionAndGetToken();

    document.getElementById('notification-form').addEventListener('submit', function(event) {
        event.preventDefault();
        var formData = {
            token: document.getElementById('token').value,
            title: document.getElementById('title').value,
            message: document.getElementById('message').value
        };
        fetch('/send-message', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        }).then(() => {
            document.getElementById('title').value = '';
            document.getElementById('message').value = '';
        }).catch(error => {
            console.error('Error:', error);
        });
    });
</script>

</html>

